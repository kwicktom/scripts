<?php
 /**
*
*   Custom Parser for PHP 5.2+
*
*   @author Nikos M.  
*   https://foo123.github.com/
*   http://nikos-web-development.netai.net/
*
**/
if (!class_exists('CustomParser')) { class CustomParser { protected static function _parseStr($s, $q) { $endq = strpos($s, $q, 1); $sq = substr($s, 1, $endq-1); $r = trim(substr($s, $endq)); return array($sq, $r); } public static function fromString($s) { $settings = array( ); $currentBuffer = null; $prevTag = null; $lines = preg_split("/\\n\\r|\\r\\n|\\r|\\n/", $s); $lenlines = count($lines); for ($i=0; $i<$lenlines; $i++) { $line = trim($lines[$i]); $linestartswith = substr($line, 0, 1); if ('#'==$linestartswith || ''==$line) continue; if ('@'==$linestartswith) { if (__startsWith($line, '@DEPENDENCIES')) { if (!isset($settings['@DEPENDENCIES'])) $settings['@DEPENDENCIES'] = array(); $currentBuffer = array('@DEPENDENCIES'); $prevTag = '@DEPENDENCIES'; continue; } elseif (__startsWith($line, '@REPLACE')) { if (!isset($settings['@REPLACE'])) $settings['@REPLACE'] = array(); $currentBuffer = array('@REPLACE'); $prevTag = '@REPLACE'; continue; } elseif (__startsWith($line, '@MINIFY')) { if (!isset($settings['@MINIFY'])) $settings['@MINIFY'] = array(); $currentBuffer = null; $prevTag = '@MINIFY'; continue; } elseif (__startsWith($line, '@OUT')) { if (!isset($settings['@OUT'])) $settings['@OUT'] = array(); $currentBuffer = array('@OUT'); $prevTag = '@OUT'; continue; } else { $currentBuffer = null; if ('@MINIFY'==$prevTag) { if (__startsWith($line, '@UGLIFY')) { if (!isset($settings['@MINIFY']['@UGLIFY'])) $settings['@MINIFY']['@UGLIFY'] = array(); $currentBuffer = array('@MINIFY', '@UGLIFY'); continue; } elseif (__startsWith($line, '@CLOSURE')) { if (!isset($settings['@MINIFY']['@CLOSURE'])) $settings['@MINIFY']['@CLOSURE'] = array(); $currentBuffer = array('@MINIFY', '@CLOSURE'); continue; } elseif (__startsWith($line, '@YUI')) { if (!isset($settings['@MINIFY']['@YUI'])) $settings['@MINIFY']['@YUI'] = array(); $currentBuffer = array('@MINIFY', '@YUI'); continue; } elseif (__startsWith($line, '@CSSMIN')) { if (!isset($settings['@MINIFY']['@CSSMIN'])) $settings['@MINIFY']['@CSSMIN'] = array(); $currentBuffer = array('@MINIFY', '@CSSMIN'); continue; } } $prevTag = null; continue; } } if ($currentBuffer) { $tmp = array_values($currentBuffer); $currentBuffer2 =& $settings; foreach ($tmp as $k) { $currentBuffer2 =& $currentBuffer2[$k]; } if ('@REPLACE'==$prevTag) { if ('"'==$linestartswith || "'"==$linestartswith) { list($key, $line) = self::_parseStr($line, $linestartswith); if (false!==strpos($line, '=', 0)) { $values = explode('=', $line, 2); $value = trim($values[1]); $valuestartswith = $value[0]; if ('"'==$valuestartswith || "'"==$valuestartswith) list($value, $rem) = self::_parseStr($value, $valuestartswith); $currentBuffer2[$key] = $value; } } else { $pair = array_map('trim', explode('=', $line, 2)); $key = $pair[0]; $value = $pair[1]; $valuestartswith = $value[0]; if ('"'==$valuestartswith || "'"==$valuestartswith) list($value, $rem) = self::_parseStr($value, $valuestartswith); $currentBuffer2[$key] = $value; } } else { $currentBuffer2[] = $line; } } } return $settings; } public static function fromFile($filename) { return self::fromString( file_get_contents($filename) ); } } }